/* * * * * * * * * * * *
 *  micromarkdown .js  *
 *    Version 0.1.6    *
 *    License:  MIT    *
 *   Simon  Waldherr   *
 * * * * * * * * * * * */

var micromarkdown={useajax:!1,regexobject:{headline:/^(\#{1,6})([^\#\n]+)\n/m,code:/\s\`\`\`\n?([^`]+)\`\`\`/g,hr:/\n(?:([\*\-_] ?)+)\1\1\n/gm,lists:/^(( *(\*|\d\.) [^\n]+)\n)+/gm,bolditalic:/(?:([\*_~]{1,3}))([^\*_~\n]+[^\*_~\s])\1/g,links:/!?\[([^\]<>]+)\]\(([^ \)<>]+)( "[^\(\)\"]+")?\)/g,reflinks:/\[([^\]]+)\]\[([^\]]+)\]/g,mail:/<(([a-z0-9_\-\.])+\@([a-z0-9_\-\.])+\.([a-z]{2,7}))>/gim,tables:/\n(([^|\n]+ *\| *)+([^|\n]+\n))((:?\-+:?\|)+(:?\-+:?)*\n)((([^|\n]+ *\| *)+([^|\n]+)\n)+)/g,include:/[\[<]include (\S+) from (https?:\/\/[a-z0-9\.\-]+\.[a-z]{2,9}[a-z0-9\.\-\?\&\/]+)[\]>]/gi,url:/<([a-zA-Z0-9@:%_\+.~#?&\/\/=]{2,256}\.[a-z]{2,4}\b(\/[\-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)?)>/g},parse:function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m=[],n=0,o=0,p=0;for(a="\n"+a+"\n";null!==(l=micromarkdown.regexobject.code.exec(a));)a=a.replace(l[0],"<code>\n"+micromarkdown.htmlEncode(l[1]).replace(/\n/gm,"<br/>").replace(/\ /gm,"&nbsp;")+"</code>\n");for(;null!==(l=micromarkdown.regexobject.headline.exec(a));)j=l[1].length,a=a.replace(l[0],"<h"+j+">"+l[2]+"</h"+j+">\n");for(;null!==(l=micromarkdown.regexobject.hr.exec(a));)a=a.replace(l[0],"\n<hr/>\n");for(;null!==(l=micromarkdown.regexobject.lists.exec(a));){for(n=0,k="*"===l[0].trim().substr(0,1)?"<ul>":"<ol>",g=l[0].split("\n"),d=0,o=0;o<g.length;o++)null!==(b=/^(( )*(\*|\d\.) ([^\n]+))/.exec(g[o]))&&(c=void 0===b[2]?0:b[2].length,d>c&&(k+="</ul>",d=c,n--),c>d&&(k+="<ul>",d=c,n++),k+="<li>"+b[4]+"</li>\n");for(;n>0;)k+="</ul>",n--;k+="*"===l[0].trim().substr(0,1)?"</ul>":"</ol>",a=a.replace(l[0],k+"\n")}for(o=0;3>o;o++)for(;null!==(l=micromarkdown.regexobject.bolditalic.exec(a));)if(k=[],"~~"===l[1])a=a.replace(l[0],"<del>"+l[2]+"</del>");else{switch(l[1].length){case 1:k=["<i>","</i>"];break;case 2:k=["<b>","</b>"];break;case 3:k=["<i><b>","</b></i>"]}a=a.replace(l[0],k[0]+l[2]+k[1])}for(;null!==(l=micromarkdown.regexobject.tables.exec(a));){for(k="<table><tr>",g=l[1].split("|"),f=l[4].split("|"),o=0;o<g.length;o++)f.length<=o?f.push(0):f[o]=":"===f[o].trimRight().slice(-1)?":"===f[o][0]?3:2:":"===f[o][0]?1:0;for(e=["<th>",'<th align="left">','<th align="right">','<th align="center">'],o=0;o<g.length;o++)k+=e[f[o]]+g[o].trim()+"</th>";for(k+="</tr>",e=["<td>",'<td align="left">','<td align="right">','<td align="center">'],h=l[7].split("\n"),o=0;o<h.length;o++)if(i=h[o].split("|"),0!==i[0].length){for(;f.length<i.length;)f.push(0);for(k+="<tr>",p=0;p<i.length;p++)k+=e[f[p]]+i[p].trim()+"</td>";k+="</tr>\n"}k+="</table>",a=a.replace(l[0],k)}for(;null!==(l=micromarkdown.regexobject.links.exec(a));)a="!"===l[0].substr(0,1)?a.replace(l[0],'<img src="'+l[2]+'" alt="'+l[1]+'" title="'+l[1]+'" />\n'):a.replace(l[0],'<a href="'+l[2]+'">'+l[1]+"</a>\n");for(;null!==(l=micromarkdown.regexobject.mail.exec(a));)a=a.replace(l[0],'<a href="mailto:'+l[1]+'">'+l[1]+"</a>");for(;null!==(l=micromarkdown.regexobject.url.exec(a));)k=l[1],-1===k.indexOf("://")&&(k="http://"+k),a=a.replace(l[0],'<a href="'+k+'">'+k.replace(/(https:\/\/|http:\/\/|mailto:|ftp:\/\/)/gim,"")+"</a>");for(;null!==(l=micromarkdown.regexobject.reflinks.exec(a));)h=new RegExp("\\["+l[2]+"\\]: ?([^ \n]+)","gi"),null!==(g=h.exec(a))&&(a=a.replace(l[0],'<a href="'+g[1]+'">'+l[1]+"</a>"),m.push(g[0]));for(o=0;o<m.length;o++)a=a.replace(m[o],"");if(micromarkdown.useajax!==!1)for(;null!==(l=micromarkdown.regexobject.include.exec(a));)if(g=l[2].replace(/[\.\:\/]+/gm,""),h="",document.getElementById(g)?h=document.getElementById(g).innerHTML.trim():micromarkdown.ajax(l[2]),"csv"===l[1]&&""!==h){for(i={},i[";"]=[],i[","]=[],i[0]=[";",","],h=h.split("\n"),p=0;p<i[0].length;p++)for(o=0;o<h.length;o++)i[i[0][p]][o]=h[o].split(i[0][p]).length,o>0&&i[i[0][p]]!==!1&&(i[i[0][p]][o]!==i[i[0][p]][o-1]||1===i[i[0][p]][o])&&(i[i[0][p]]=!1);if(i[","]!==!1||i[";"]!==!1){for(i=i[";"]!==!1?";":",",k="<table>",o=0;o<h.length;o++){for(g=h[o].split(i),k+="<tr>",p=0;p<g.length;p++)k+="<td>"+micromarkdown.htmlEncode(g[p])+"</td>";k+="</tr>"}k+="</table>",a=a.replace(l[0],k)}else a=a.replace(l[0],"<code>"+h.join("\n")+"</code>")}else a=a.replace(l[0],"");return a=a.replace(/ {2,}[\n]{1,}/gim,"<br/><br/>")},ajax:function(a){"use strict";var b;if(document.getElementById(a.replace(/[\.\:\/]+/gm,"")))return!1;if(window.ActiveXObject)try{b=new ActiveXObject("Microsoft.XMLHTTP")}catch(c){return b=null,c}else b=new XMLHttpRequest;b.onreadystatechange=function(){if(4===b.readyState){var c=document.createElement("code");c.innerHTML=b.responseText,c.id=a.replace(/[\.\:\/]+/gm,""),c.style.display="none",document.getElementsByTagName("body")[0].appendChild(c),micromarkdown.useajax()}},b.open("GET",a,!0),b.setRequestHeader("Content-type","application/x-www-form-urlencoded"),b.send()},countingChars:function(a,b){"use strict";return a=a.split(b),"object"==typeof a?a.length-1:0},htmlEncode:function(a){"use strict";return a.replace(/[^a-zA-Z0-9\.:\n]/g,function(a){return"&"+(micromarkdown.entityTable[a.charCodeAt(0)]||"#"+a.charCodeAt(0))+";"})},entityTable:{32:"nbsp",34:"quot",38:"amp",39:"apos",60:"lt",62:"gt",161:"iexcl",162:"cent",163:"pound",164:"curren",165:"yen",166:"brvbar",167:"sect",168:"uml",169:"copy",170:"ordf",171:"laquo",172:"not",173:"shy",174:"reg",175:"macr",176:"deg",177:"plusmn",178:"sup2",179:"sup3",180:"acute",181:"micro",196:"Auml",203:"Euml",207:"Iuml",214:"Ouml",220:"Uuml",223:"szlig",228:"auml",235:"euml",239:"iuml",246:"ouml",252:"uuml",255:"yuml",913:"Alpha",914:"Beta",915:"Gamma",916:"Delta",917:"Epsilon",918:"Zeta",919:"Eta",920:"Theta",921:"Iota",922:"Kappa",923:"Lambda",924:"Mu",925:"Nu",926:"Xi",927:"Omicron",928:"Pi",929:"Rho",931:"Sigma",932:"Tau",933:"Upsilon",934:"Phi",935:"Chi",936:"Psi",937:"Omega",945:"alpha",946:"beta",947:"gamma",948:"delta",949:"epsilon",950:"zeta",951:"eta",952:"theta",953:"iota",954:"kappa",955:"lambda",956:"mu",957:"nu",958:"xi",959:"omicron",960:"pi",961:"rho",962:"sigmaf",963:"sigma",964:"tau",965:"upsilon",966:"phi",967:"chi",968:"psi",969:"omega",8364:"euro"}};

/* /micromarkdown */
